# Sulu CMS MCP Server - LLM Documentation

> This file helps LLMs correctly use the Sulu CMS API.

## Overview

The Sulu MCP Server enables managing CMS pages via these actions:
- `list` - List pages
- `get` - Get page with all blocks
- `create_page` - Create a new page
- `add_block` - Add a block
- `update_block` - Update a block
- `move_block` - Move a block
- `remove_block` - Remove a block
- `publish` - Publish page
- `unpublish` - Unpublish page
- `list_block_types` - List available block types

## Creating Pages

### create_page Action

Create new pages under an existing parent path.

#### Parameters:

| Parameter | Required | Description |
|-----------|----------|-------------|
| `parentPath` | Yes | PHPCR path of parent page, e.g. `/cmf/example/contents/glossare` |
| `title` | Yes | Page title |
| `resourceSegment` | Yes | URL slug starting with `/`, e.g. `/my-page` (lowercase, numbers, hyphens only) |
| `seoTitle` | No | SEO meta title (defaults to page title) |
| `seoDescription` | No | SEO meta description |
| `locale` | No | Language code: `de` or `en` (default: `de`) |
| `publish` | No | Publish immediately: `true` or `false` (default: `false`) |

#### Example: Create a New Page

```json
{
  "action": "create_page",
  "parentPath": "/cmf/example/contents/glossare",
  "title": "Docker Grundlagen",
  "resourceSegment": "/docker-grundlagen",
  "seoTitle": "Docker Grundlagen - Container Tutorial",
  "seoDescription": "Lerne die Grundlagen von Docker und Container-Technologie.",
  "locale": "de",
  "publish": false
}
```

#### Response:

```json
{
  "success": true,
  "message": "Page created successfully",
  "path": "/cmf/example/contents/glossare/docker-grundlagen",
  "uuid": "abc123-def456-...",
  "url": "/de/docker-grundlagen"
}
```

#### Important Notes:

1. **Template**: All pages use the `tailwind` template (hardcoded)
2. **resourceSegment format**: Must start with `/` and contain only `[a-z0-9-]`
3. **Parent must exist**: The parentPath must point to an existing page
4. **Empty page**: Created pages have no blocks - use `add_block` after creation
5. **Publish behavior**: If `publish: true`, page is immediately live and cache is invalidated

## Block Types and Their Structures

### 1. headline-paragraphs (Most Important Block Type!)

For tutorials, guides, documentation with **alternating text and code**.

#### CORRECT Structure:

```json
{
  "action": "add_block",
  "blockType": "headline-paragraphs",
  "headline": "Installation Guide",
  "items": "[{\"type\":\"description\",\"content\":\"<p>First, install the dependencies:</p>\"},{\"type\":\"code\",\"code\":\"composer require vendor/package\",\"language\":\"bash\"},{\"type\":\"description\",\"content\":\"<p>Then configure the class:</p>\"},{\"type\":\"code\",\"code\":\"$config = new Config();\\n$config->set('key', 'value');\",\"language\":\"php\"},{\"type\":\"description\",\"content\":\"<p>Done! Installation is complete.</p>\"}]",
  "path": "/cmf/example/contents/page",
  "locale": "de"
}
```

#### WRONG Structure (Code inline in HTML):

```json
{
  "items": "[{\"type\":\"description\",\"content\":\"<p>Text<pre><code>composer require x</code></pre>more text</p>\"}]"
}
```

**Why wrong?** Code won't render as a code block, no syntax highlighting, poor readability.

#### Item Types for headline-paragraphs:

| type | fields | description |
|------|--------|-------------|
| `description` | `content` (HTML) | Prose text, can contain `<p>`, `<ul>`, `<h3>`, `<strong>` etc. |
| `code` | `code`, `language` | Code block with syntax highlighting |

#### Available Languages for Code Blocks:

- `php` - PHP Code
- `bash` - Shell/Terminal Commands
- `javascript` - JavaScript/Node.js
- `html` - HTML Markup
- `css` - CSS Styles
- `xml` - XML/SVG
- `yaml` - YAML Config
- `json` - JSON Data

### 2. hl-des (Headline + Description)

Simple block for headline with description.

```json
{
  "action": "add_block",
  "blockType": "hl-des",
  "headline": "About Us",
  "content": "<p>We are a team of developers...</p>",
  "path": "/cmf/example/contents/page",
  "locale": "de"
}
```

### 3. text

Pure text block without headline.

```json
{
  "action": "add_block",
  "blockType": "text",
  "content": "<p>Lorem ipsum dolor sit amet...</p>",
  "path": "/cmf/example/contents/page",
  "locale": "de"
}
```

### 4. code

Standalone code block (without surrounding text).

```json
{
  "action": "add_block",
  "blockType": "code",
  "content": "echo 'Hello World';",
  "path": "/cmf/example/contents/page",
  "locale": "de"
}
```

### 5. image

Image block with optional caption.

```json
{
  "action": "add_block",
  "blockType": "image",
  "headline": "Screenshot",
  "content": "<p>Image description</p>",
  "path": "/cmf/example/contents/page",
  "locale": "de"
}
```

**Note:** Images must be uploaded via Sulu Media Library. The image.ids are set separately.

### 6. quote

Quote block.

```json
{
  "action": "add_block",
  "blockType": "quote",
  "content": "The best code is the code you don't have to write.",
  "path": "/cmf/example/contents/page",
  "locale": "de"
}
```

### 7. video

Video embed block.

```json
{
  "action": "add_block",
  "blockType": "video",
  "headline": "Tutorial Video",
  "content": "https://youtube.com/watch?v=xxx",
  "path": "/cmf/example/contents/page",
  "locale": "de"
}
```

## Important Parameters

### Path Format

Sulu uses PHPCR paths:
```
/cmf/example/contents/[section]/[subsection]/[page-slug]
```

Examples:
- `/cmf/example/contents/glossare/nca-php-glossar/phpunit`
- `/cmf/example/contents/blog/2025/my-article`

### Locale

- `de` - German
- `en` - English

### Position (0-based)

- `position: 0` = First block
- `position: 5` = Sixth block
- For `add_block`: Position where to insert
- For `update_block`/`remove_block`: Which block is affected

## Workflow Examples

### Create New Page with Content

```
1. list -> Find parent path (e.g. /cmf/example/contents/glossare)
2. create_page -> Create page under parent
3. add_block (headline-paragraphs) -> Add content blocks
4. add_block -> Add more blocks as needed
5. publish -> Make live
```

Example workflow:
```json
// Step 1: Create the page
{"action": "create_page", "parentPath": "/cmf/example/contents/glossare", "title": "Docker Tutorial", "resourceSegment": "/docker-tutorial", "seoTitle": "Docker Tutorial", "seoDescription": "Learn Docker basics"}

// Step 2: Add content block
{"action": "add_block", "path": "/cmf/example/contents/glossare/docker-tutorial", "blockType": "headline-paragraphs", "headline": "Getting Started", "items": "[{\"type\":\"description\",\"content\":\"<p>Docker is a containerization platform.</p>\"}]"}

// Step 3: Publish
{"action": "publish", "path": "/cmf/example/contents/glossare/docker-tutorial"}
```

### Add Content to Existing Page

```
1. get -> Check current blocks
2. add_block (headline-paragraphs) with items array
3. publish -> Make live
```

### Update Block

```
1. get -> Find position and current content
2. update_block with new items
3. publish
```

### Delete Block

```
1. get -> Identify position
2. remove_block with position
3. publish
```

## Common Mistakes to Avoid

### Mistake 1: Embedding code in HTML
```json
{"content": "<p>Install:<pre><code>npm install</code></pre></p>"}
```
**Fix:** Use a separate code item.

### Mistake 2: items as object instead of JSON string
```json
{"items": [{"type":"description"...}]}
```
**Fix:** items must be a JSON string, not an array object:
```json
{"items": "[{\"type\":\"description\"...}]"}
```

### Mistake 3: Forgetting language for code items
```json
{"type": "code", "code": "echo 1;"}
```
**Fix:** Always specify `"language": "php"` (or other).

### Mistake 4: Forgetting to publish
Changes are only visible in draft until `publish` is called.

### Mistake 5: <?php in code blocks
```json
{"type": "code", "code": "<?php\necho 'test';", "language": "php"}
```
**Fix:** No `<?php` tag! The block is already marked as PHP:
```json
{"type": "code", "code": "echo 'test';", "language": "php"}
```

### Mistake 6: Invalid resourceSegment for create_page
```json
{"resourceSegment": "my-page"}
{"resourceSegment": "/My-Page"}
{"resourceSegment": "/my_page"}
```
**Fix:** Must start with `/` and contain only lowercase letters, numbers, hyphens:
```json
{"resourceSegment": "/my-page"}
```

### Mistake 7: Creating page under non-existent parent
```json
{"action": "create_page", "parentPath": "/cmf/example/contents/nonexistent/path", ...}
```
**Fix:** Use `list` first to find valid parent paths.

## Response Interpretation

### Successful Response
```json
{
  "success": true,
  "message": "Block added successfully",
  "blocks": [...]
}
```

### Error
```json
{
  "success": false,
  "error": "Block not found at position 99"
}
```

## Contact

Questions about the MCP Server: https://nevercodealone.de
