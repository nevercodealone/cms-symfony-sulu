# Sulu CMS MCP Server - LLM Documentation

> This file helps LLMs correctly use the Sulu CMS API.

---

## ARCHITECTURE WARNING - READ FIRST

**This MCP server uses DIRECT DATABASE ACCESS intentionally. DO NOT suggest refactoring to use Sulu's DocumentManager.**

### Why Direct Database (DBAL) Instead of DocumentManager?

1. **Long-running process**: MCP server runs continuously. DocumentManager causes "MySQL server has gone away" errors and entity state corruption in long-lived processes.

2. **Connection timeouts**: DocumentManager's internal connection pooling doesn't handle connection drops gracefully. Direct DBAL reconnects automatically.

3. **Event dispatcher conflicts**: DocumentManager triggers Sulu's event system (subscribers, workflows) which expects HTTP request context that doesn't exist in MCP.

4. **Cache clearing issues**: `$documentManager->clear()` causes connection errors. We tried it, rolled it back (see commit c3657fa).

### What NOT to Suggest

- "Use DocumentManager instead of raw SQL" - NO, it breaks in MCP context
- "Use PageDocument for cleaner code" - NO, same issues
- "Flush via DocumentManager" - NO, causes connection errors
- "Clear DocumentManager cache" - NO, causes "server gone away" errors
- "Use StructureBridge" - NO, requires event dispatching

### What IS Correct

- Direct `$connection->fetchAssociative()` queries to `phpcr_nodes` table
- XML manipulation via DOMDocument/DOMXPath for block CRUD
- BlockWriter/BlockExtractor classes for PHPCR XML handling
- Manual cache invalidation via HttpCacheClearer

### Code Locations

| File | Purpose |
|------|---------|
| `src/Sulu/Service/PageService.php` | Page CRUD operations - direct DB queries |
| `src/Sulu/Service/SnippetService.php` | Snippet listing - direct DB queries |
| `src/Sulu/Service/MediaService.php` | Media listing/search - direct DB queries |
| `src/Sulu/Block/BlockWriter.php` | Writes blocks to PHPCR XML |
| `src/Sulu/Block/BlockExtractor.php` | Reads blocks from PHPCR XML |
| `src/Sulu/Block/BlockTypeRegistry.php` | Block schemas, descriptions & examples |
| `src/Sulu/Block/BlockValidator.php` | Validates blocks before write |
| `src/MCP/Tools/SuluPagesTool.php` | MCP tool exposing all actions |

### Service Separation Architecture

The MCP server follows Single Responsibility Principle with focused services:

```
src/Sulu/
├── Service/
│   ├── PageService.php          # Page CRUD only
│   ├── MediaService.php         # Media listing/search
│   └── SnippetService.php       # Snippet operations
├── Block/
│   ├── BlockTypeRegistry.php    # Schemas + descriptions + examples
│   ├── BlockExtractor.php       # XML reading
│   ├── BlockWriter.php          # XML writing
│   └── BlockValidator.php       # Validation
```

---

## Nested Block Type Reference (CRITICAL)

Blocks with nested items require the correct `type` value for each nested item. Using the wrong type prevents frontend rendering.

### Complete Nested Type Mapping

| Block Type | Nested Array Name | Nested Item Type | Example Item |
|------------|-------------------|------------------|--------------|
| `faq` | `faqs` | `items` | `{"type":"items","headline":"Q?","subline":"A"}` |
| `card-trio` | `cards` | `card` | `{"type":"card","title":"Title","icon":"code"}` |
| `table` | `rows` | `row` | `{"type":"row","cell1":"A","cell2":"B","cell3":"C"}` |
| `image-with-flags` | `flags` | `flag` | `{"type":"flag","language":"en","url":"/en"}` |
| `headline-paragraphs` | `items` | `description` or `code` | `{"type":"description","description":"<p>Text</p>"}` |
| `feature` | `items` | `items` | `{"type":"items","headline":"Title","description":"<p>Text</p>"}` |
| `feature-default` | `items` | `items` | `{"type":"items","headline":"Title","description":"<p>Text</p>"}` |
| `feature-with-icons` | `items` | `items` | `{"type":"items","headline":"Title","text":"Text"}` |
| `formats` | `items` | `items` | `{"type":"items","icon":"user","headline":"Title"}` |
| `introduction` | `items` | `items` | `{"type":"items","description":"<p>Text</p>"}` |
| `hero-image-right` | `items` | `items` | `{"type":"items","headline":"Title","text":"Text"}` |
| `logo-gallary` | `items` | `items` | `{"type":"items","headline":"Alt","url":"https://..."}` |

### Why This Matters

Sulu's Twig templates check the `type` field when rendering nested items:
```twig
{% for item in content.faqs %}
    {# Only renders if item.type matches XML default-type #}
{% endfor %}
```

If the type is wrong (e.g., `"type":"faq"` instead of `"type":"items"`), items are stored but **not rendered**.

### API Response Enhancement

The `get_block_schema` and `list_block_types` actions now return `nestedType` for each block:
```json
{
  "name": "faq",
  "nested": "faqs",
  "nestedType": "items",
  "nestedProperties": ["headline", "subline"]
}
```

---

## IMPORTANT: Rich Text vs Plain Text Fields

Sulu has two field types. Using the wrong format breaks frontend rendering.

### Rich-text fields (HTML required)
These fields MUST contain HTML tags like `<p>`, `<strong>`, `<a>`:
- `description` — in 25+ block types
- `descriptiontwo` — in introduction block
- `code` — in headline-paragraphs nested code items
- `html` — in html-raw block (iframes, embeds)

Correct: `"description": "<p>This is a paragraph with <strong>bold</strong> text.</p>"`

### Plain-text fields (NO HTML — ever)
ALL other fields are plain text. Never wrap them in HTML tags:
- `headline`, `subline`, `text`, `title`, `buttonText`, `linkText`, `badgeText`
- `columnheader1/2/3`, `cell1/2/3`, `language`, `playlistid`
- `seoTitle`, `seoDescription`, `excerptTitle`, `excerptDescription`
- `url`, `urltwo`, `textone`, `texttwo`, `buttonTextTwo`
- FAQ `subline` (this is plain text, NOT HTML)

Correct: `"headline": "Meine Überschrift"`
WRONG: `"headline": "<p>Meine Überschrift</p>"` — tags render as visible text

### Why this matters
All 33 Twig block templates render plain-text fields auto-escaped (no |raw filter).
HTML tags in plain-text fields appear literally as `<p>...</p>` on the website.

---

## Overview

The Sulu MCP Server enables managing CMS pages via these actions:

### Page Discovery
- `list` - List all pages under a path
- `get` - Get page with all blocks
- `search` - Search pages by title (case-insensitive)
- `tree` - Get hierarchical page tree structure
- `find_by_url` - Find page by frontend URL

### Page Management
- `create_page` - Create a new page
- `copy_page` - Copy a page with all blocks to a new location
- `update_excerpt` - Update excerpt (title, description, image) on an existing page
- `publish` - Publish page
- `unpublish` - Unpublish page

### Block Management
- `add_block` - Add a block
- `update_block` - Update a block
- `append_to_block` - Append items to existing block
- `move_block` - Move a block
- `remove_block` - Remove a block
- `list_block_types` - List all 34 block types with descriptions & examples
- `get_block_schema` - Get detailed schema for a specific block type

### Media & Snippets
- `list_media` - Search/list media with pagination
- `list_snippets` - List snippets with diagnostic info

## Page Discovery

Use these tools to find pages before creating or modifying content.

### search Action

Search pages by title (case-insensitive).

```json
{
  "action": "search",
  "query": "PHP",
  "locale": "de"
}
```

Response:
```json
[
  {"path": "/cmf/example/contents/php-glossar", "title": "PHP Glossar", "url": "/php-glossar"},
  {"path": "/cmf/example/contents/php-training", "title": "PHP Training", "url": "/php-training"}
]
```

### tree Action

Get hierarchical page structure. Use to find parent paths for new pages.

```json
{
  "action": "tree",
  "rootPath": "/cmf/example/contents/glossare",
  "locale": "de",
  "depth": 2
}
```

### find_by_url Action

Convert frontend URL to PHPCR path.

```json
{
  "action": "find_by_url",
  "url": "/php-glossar",
  "locale": "de"
}
```

## Creating Pages

### sulu-page-create

Create new pages under an existing parent path.

**IMPORTANT:** Always use `sulu-page-tree` first to find valid parent paths!

#### Parameters:

| Parameter | Required | Description |
|-----------|----------|-------------|
| `parentPath` | Yes | PHPCR path of parent page |
| `title` | Yes | Page title |
| `resourceSegment` | Yes | URL slug starting with `/`, e.g. `/my-page` |
| `locale` | No | Language code: `de` or `en` (default: `de`) |
| `seoTitle` | No | SEO meta title |
| `seoDescription` | No | SEO meta description |
| `publish` | No | Publish immediately (default: `false`) |
| `excerptTitle` | No | Excerpt title for preview cards and listing pages |
| `excerptDescription` | No | Excerpt description for preview cards |
| `excerptImage` | No | Media ID for excerpt image (use `list_media` to find IDs) |

### Copying Pages

#### copy_page Action

Copy a page with all blocks to a new location. Inherits excerpt data from source unless overridden.

**Parameters:**

| Parameter | Required | Description |
|-----------|----------|-------------|
| `sourcePath` | Yes | PHPCR path of source page to copy (or use `path`) |
| `title` | Yes | Title for the new page |
| `resourceSegment` | Yes | URL slug starting with `/` |
| `parentPath` | No | Parent path (defaults to source's parent) |
| `seoTitle` | No | SEO meta title |
| `seoDescription` | No | SEO meta description |
| `excerptTitle` | No | Excerpt title (inherits from source if not set) |
| `excerptDescription` | No | Excerpt description (inherits from source if not set) |
| `excerptImage` | No | Media ID for excerpt image (inherits from source if not set) |
| `publish` | No | Publish after copy (default: `false`, only publishes if all blocks succeed) |

**Behavior:**
- Creates as **draft first**, only publishes if `publish: true` AND all blocks copied successfully
- **Excerpt inheritance**: excerpt title, description, and image are copied from source unless explicitly overridden
- **Shared media**: media IDs are copied as-is (references same media, no duplication)
- **Block validation**: each block is validated for the target path (e.g., `hl-des` restriction to `/training/*` still applies)
- **Block media**: All media references (images, image) in blocks are preserved with their IDs and displayOption
- **Full fidelity**: Every block field (text, URLs, settings, nested items, media) is copied 1:1 from source
- **Partial failure**: if some blocks fail validation, the page is still created with successful blocks

**Example:**
```json
{
  "action": "copy_page",
  "sourcePath": "/cmf/example/contents/glossare/nca-php-glossar/phpunit",
  "parentPath": "/cmf/example/contents/glossare/nca-php-glossar",
  "title": "PHPStan",
  "resourceSegment": "/phpstan",
  "seoTitle": "PHPStan - PHP Static Analysis Tool",
  "seoDescription": "PHPStan findet Fehler in PHP-Code ohne ihn auszuführen.",
  "publish": "true"
}
```

**Response:**
```json
{
  "success": true,
  "message": "Page copied successfully (5 blocks copied)",
  "path": "/cmf/example/contents/glossare/nca-php-glossar/phpstan",
  "uuid": "abc-123-def",
  "url": "/de/glossare/nca-php-glossar/phpstan",
  "blocksCopied": 5,
  "blocksFailed": 0
}
```

**Copy and Customize Workflow:**
```
1. copy_page: Copy template page to new location
2. update_block: Customize individual blocks with new content
3. publish: Make the page live
```

### Updating Excerpts

#### update_excerpt Action

Update excerpt metadata (title, description, image) on an existing page. Use this to edit excerpt data after page creation.

**What are excerpts?** Excerpts are teaser/preview metadata used by Sulu across the site:
- **Listing pages**: `subpages-overview` blocks display child pages using their excerpt title, description, and image as preview cards
- **Related content**: `related-content-by-page-tag` blocks use excerpt data for content recommendations
- **Social sharing**: Excerpt data feeds Open Graph / social media preview cards
- **Navigation teasers**: Any template that renders page teasers pulls from excerpt fields
- **SEO**: Search engines may use excerpt descriptions for rich snippets

Without excerpt data, pages appear with blank or fallback teasers in listings and navigation blocks.

**Parameters:**

| Parameter | Required | Description |
|-----------|----------|-------------|
| `path` | Yes | PHPCR path of the page to update |
| `excerptTitle` | No | New excerpt title (set to `null` to clear) |
| `excerptDescription` | No | New excerpt description (set to `null` to clear) |
| `excerptImage` | No | Media ID for excerpt image (set to `null` to clear) |

At least one of `excerptTitle`, `excerptDescription`, or `excerptImage` is required.

**Example — update excerpt on existing page:**
```json
{
  "action": "update_excerpt",
  "path": "/cmf/example/contents/glossare/nca-php-glossar/phpunit",
  "excerptTitle": "PHPUnit - PHP Testing Framework",
  "excerptDescription": "PHPUnit ist das Standard-Testframework für PHP-Anwendungen.",
  "excerptImage": 993
}
```

**Response:**
```json
{
  "success": true,
  "message": "Excerpt updated successfully",
  "excerpt": {
    "title": "PHPUnit - PHP Testing Framework",
    "description": "PHPUnit ist das Standard-Testframework für PHP-Anwendungen.",
    "images": {"ids": [993]}
  }
}
```

**Example — clear excerpt image:**
```json
{
  "action": "update_excerpt",
  "path": "/cmf/example/contents/my-page",
  "excerptImage": null
}
```

---

## Page Response Enhancements

### Excerpt Data

The `get` action returns an `excerpt` object with the page's excerpt metadata:

```json
{
  "path": "/cmf/example/contents/my-page",
  "title": "My Page",
  "excerpt": {
    "title": "Excerpt Title",
    "description": "Excerpt description text",
    "images": {"ids": [42]}
  }
}
```

Excerpt values are `null` when not set. Use `list_media` to find media IDs for `excerptImage`.

**Setting/updating excerpts:**
- During creation: pass `excerptTitle`, `excerptDescription`, `excerptImage` to `create_page` or `copy_page`
- After creation: use `update_excerpt` to modify excerpt data on existing pages

### Snippet Title Resolution

Contact blocks with snippet UUIDs now return resolved titles instead of raw UUIDs:

```json
{
  "type": "contact",
  "snippets": [
    {"uuid": "abc-123-def", "title": "Main Contact"},
    {"uuid": "ghi-456-jkl", "title": "Support Contact"}
  ]
}
```

If a snippet UUID cannot be resolved, `title` will be `null`.

---

## Block Type User Stories (34 Types)

**As a content editor**, understand what each block accomplishes:

### Content Blocks
| Block | User Story |
|-------|-----------|
| **headline-paragraphs** | I want to create tutorials with mixed text and code, so developers can follow step-by-step instructions |
| **faq** | I want to create FAQ sections with questions and answers, so visitors can quickly find common answers. **Uses `faqs[]` NOT `items[]`!** |
| **code** | I want to display standalone code snippets with syntax highlighting |
| **introduction** | I want to create intro sections with bullet points and two text areas |
| **table** | I want to display data in 3-column tables with headers. **Uses `rows[]` NOT `items[]`!** |

### Hero Blocks
| Block | User Story |
|-------|-----------|
| **hero** | I want to create eye-catching page headers with image, headline, and CTA button |
| **hero-startpage** | I want a homepage hero with dual headlines and two action buttons |
| **hero-image-right** | I want a hero section with image on the right and feature list on left |
| **heroslider** | I want a hero with multiple sliding images |

### Feature Blocks
| Block | User Story |
|-------|-----------|
| **feature** | I want to showcase features with checkmark icons and descriptions |
| **feature-default** | I want a grid layout of feature cards |
| **feature-with-icons** | I want features with nested icon bullet lists |
| **formats** | I want to display format options with selectable icons (user/newsletter/github) |

### Card Blocks
| Block | User Story |
|-------|-----------|
| **card-trio** | I want to display 3 service/feature cards with icons, badges, tags, and internal page links |

### Contact Blocks
| Block | User Story |
|-------|-----------|
| **team** | I want to display team members from Sulu contact database |
| **consultant** | I want to show a single contact person |
| **contact** | I want to include contact info from snippets |
| **chat** | I want to embed a chat widget or interactive element |

### Navigation Blocks
| Block | User Story |
|-------|-----------|
| **highlights** | I want to display snippet-based highlights |
| **subpages-overview** | I want to automatically list all child pages |
| **table-of-contents** | I want an auto-generated TOC from page headings |

---

## Complete Block Type Reference (34 Types)

All blocks are defined in `config/templates/includes/tailwind/blocks/*.xml` and render via `templates/includes/tailwind/blocks/*.html.twig`.

---

### CONTENT BLOCKS

#### 1. headline-paragraphs (Main Content Block)

Primary block for tutorials, guides, documentation with alternating text and code.

**XML:** `config/templates/includes/tailwind/blocks/headline-paragraphs.xml`
**Twig:** `templates/includes/tailwind/blocks/headline-paragraphs.html.twig`

| Property | Type | Description |
|----------|------|-------------|
| `headline` | text_line | Main heading |
| `items[]` | nested block | Array of content items |

**Nested items structure:**
| Item Type | Properties | Description |
|-----------|------------|-------------|
| `description` | `description` (text_editor) | Rich text paragraph |
| `code` | `code` (text_editor) | Code snippet |

```json
{
  "blockType": "headline-paragraphs",
  "headline": "Installation Guide",
  "items": "[{\"type\":\"description\",\"description\":\"<p>Install dependencies:</p>\"},{\"type\":\"code\",\"code\":\"composer require vendor/package\"},{\"type\":\"description\",\"description\":\"<p>Configuration complete.</p>\"}]"
}
```

---

#### 2. faq (FAQ Accordion)

FAQ block with question/answer pairs.

**XML:** `config/templates/includes/tailwind/blocks/faq.xml`
**Twig:** `templates/includes/tailwind/blocks/faq.html.twig`

| Property | Type | Description |
|----------|------|-------------|
| `faqs[]` | nested block | Array of FAQ items |

**Nested faqs structure:**
| Property | Type | Description |
|----------|------|-------------|
| `headline` | text_line | Question |
| `subline` | text_line | Answer |

```json
{
  "blockType": "faq",
  "faqs": "[{\"headline\":\"What is PHP?\",\"subline\":\"PHP is a server-side scripting language.\"},{\"headline\":\"What is Composer?\",\"subline\":\"Composer is a dependency manager for PHP.\"}]"
}
```

**Twig rendering:**
```twig
{% for item in content.faqs %}
  <h2>{{ item.headline }}</h2>
  <p>{{ item.subline }}</p>
{% endfor %}
```

---

#### 3. code (Standalone Code Block)

Code block with description.

**XML:** `config/templates/includes/tailwind/blocks/code.xml`
**Twig:** `templates/includes/tailwind/blocks/code.html.twig`

| Property | Type | Description |
|----------|------|-------------|
| `description` | text_editor | Code content |

```json
{
  "blockType": "code",
  "description": "<pre><code>echo 'Hello World';</code></pre>"
}
```

---

#### 4. introduction (Text with Bullet Points)

Introduction block with headline, description, bullet items, and bottom text.

**XML:** `config/templates/includes/tailwind/blocks/introduction.xml`
**Twig:** `templates/includes/tailwind/blocks/introduction.html.twig`

| Property | Type | Description |
|----------|------|-------------|
| `headline` | text_line | Main heading |
| `description` | text_editor | Intro text |
| `items[]` | nested block | Bullet points |
| `descriptiontwo` | text_editor | Bottom text |

**Nested items:**
| Property | Type | Description |
|----------|------|-------------|
| `description` | text_editor | Bullet point text |

```json
{
  "blockType": "introduction",
  "headline": "Why Choose Us",
  "description": "<p>We offer the best service.</p>",
  "items": "[{\"description\":\"<p>Fast delivery</p>\"},{\"description\":\"<p>24/7 support</p>\"}]",
  "descriptiontwo": "<p>Contact us today!</p>"
}
```

---

#### 5. table (Data Table)

Table with headers and rows.

**XML:** `config/templates/includes/tailwind/blocks/table.xml`
**Twig:** `templates/includes/tailwind/blocks/table.html.twig`

| Property | Type | Description |
|----------|------|-------------|
| `headline` | text_line | Table title |
| `description` | text_editor | Table description |
| `columnheader1` | text_line | Header column 1 |
| `columnheader2` | text_line | Header column 2 |
| `columnheader3` | text_line | Header column 3 |
| `rows[]` | nested block | Table rows |

**Nested rows:**
| Property | Type | Description |
|----------|------|-------------|
| `cell1` | text_line | Column 1 value |
| `cell2` | text_line | Column 2 value |
| `cell3` | text_line | Column 3 value |

```json
{
  "blockType": "table",
  "headline": "Pricing",
  "columnheader1": "Plan",
  "columnheader2": "Price",
  "columnheader3": "Features",
  "rows": "[{\"cell1\":\"Basic\",\"cell2\":\"$10\",\"cell3\":\"5 users\"},{\"cell1\":\"Pro\",\"cell2\":\"$25\",\"cell3\":\"Unlimited\"}]"
}
```

---

### HERO BLOCKS

#### 6. hero (Standard Hero)

Hero section with image, headline, description, and CTA button.

**XML:** `config/templates/includes/tailwind/blocks/hero.xml`
**Twig:** `templates/includes/tailwind/blocks/hero.html.twig`

| Property | Type | Description |
|----------|------|-------------|
| `image` | media_selection | Hero image (max 1) |
| `headline` | text_line | Main heading |
| `description` | text_editor | Hero text |
| `buttonText` | text_line | CTA button label |
| `url` | url | CTA button link |

```json
{
  "blockType": "hero",
  "headline": "Welcome to Our Site",
  "description": "<p>We build amazing software.</p>",
  "buttonText": "Get Started",
  "url": "https://example.com/signup"
}
```

---

#### 7. hero-startpage (Homepage Hero)

Extended hero for homepage with two-part headline and dual buttons.

**XML:** `config/templates/includes/tailwind/blocks/hero-startpage.xml`
**Twig:** `templates/includes/tailwind/blocks/hero-startpage.html.twig`

| Property | Type | Description |
|----------|------|-------------|
| `image` | media_selection | Hero image |
| `textone` | text_line | Headline part 1 |
| `texttwo` | text_line | Headline part 2 |
| `description` | text_editor | Hero description |
| `buttonText` | text_line | Primary button text |
| `buttonLink` | single_page_selection | Primary button page link |
| `buttonTextTwo` | text_line | Secondary button text |
| `url` | url | Secondary button URL |

---

#### 8. hero-image-right (Hero with Image Right)

Hero with image on right side and feature items.

**XML:** `config/templates/includes/tailwind/blocks/hero-image-right.xml`
**Twig:** `templates/includes/tailwind/blocks/hero-image-right.html.twig`

| Property | Type | Description |
|----------|------|-------------|
| `image` | media_selection | Right-side image |
| `headline` | text_line | Main heading |
| `description` | text_editor | Description |
| `items[]` | nested block | Feature items |

**Nested items:**
| Property | Type | Description |
|----------|------|-------------|
| `headline` | text_line | Item headline |
| `text` | text_line | Item text |
| `buttonText` | text_line | Button label |
| `buttonLink` | single_page_selection | Button page |
| `url` | url | External URL |

---

#### 9. heroslider (Hero Slider)

Slider hero with multiple images and optional page links.

**XML:** `config/templates/includes/tailwind/blocks/heroslider.xml`
**Twig:** `templates/includes/tailwind/blocks/heroslider.html.twig`

| Property | Type | Description |
|----------|------|-------------|
| `headline` | text_line | Slider headline |
| `description` | text_editor | Description |
| `pageurl1` | page_selection | Optional page link 1 |
| `pageurl2` | page_selection | Optional page link 2 |
| `images` | media_selection | Slider images (1-6) |

---

### CTA & BUTTON BLOCKS

#### 10. cta-button (Call-to-Action)

CTA section with headline, description, and two buttons.

**XML:** `config/templates/includes/tailwind/blocks/cta-button.xml`
**Twig:** `templates/includes/tailwind/blocks/cta-button.html.twig`

| Property | Type | Description |
|----------|------|-------------|
| `headline` | text_line | CTA headline |
| `description` | text_editor | CTA description |
| `text` | text_line | Primary button text |
| `url` | url | Primary button URL |
| `texttwo` | text_line | Secondary button text |
| `urltwo` | url | Secondary button URL |

```json
{
  "blockType": "cta-button",
  "headline": "Ready to Start?",
  "description": "<p>Join thousands of happy customers.</p>",
  "text": "Sign Up Free",
  "url": "/signup",
  "texttwo": "Learn More",
  "urltwo": "/features"
}
```

---

#### 11. button (Simple Button)

Simple button link.

**XML:** `config/templates/includes/tailwind/blocks/button.xml`
**Twig:** `templates/includes/tailwind/blocks/button.html.twig`

| Property | Type | Description |
|----------|------|-------------|
| `buttonText` | text_line | Button label |
| `url` | url | Button link |

---

### FEATURE BLOCKS

#### 12. feature (Feature Showcase)

Feature section with subline, headline, description, and feature items.

**XML:** `config/templates/includes/tailwind/blocks/feature.xml`
**Twig:** `templates/includes/tailwind/blocks/feature.html.twig`

| Property | Type | Description |
|----------|------|-------------|
| `subline` | text_line | Small text above headline |
| `headline` | text_line | Main heading |
| `description` | text_editor | Description |
| `items[]` | nested block | Feature items |

**Nested items:**
| Property | Type | Description |
|----------|------|-------------|
| `headline` | text_line | Feature title |
| `description` | text_editor | Feature description |

---

#### 13. feature-default (Default Feature Grid)

Feature grid with headline, description, and items.

**XML:** `config/templates/includes/tailwind/blocks/feature-default.xml`
**Twig:** `templates/includes/tailwind/blocks/feature-default.html.twig`

| Property | Type | Description |
|----------|------|-------------|
| `headline` | text_line | Section headline |
| `description` | text_editor | Section description |
| `items[]` | nested block | Feature items |

**Nested items:**
| Property | Type | Description |
|----------|------|-------------|
| `headline` | text_line | Feature title |
| `description` | text_editor | Feature text |

---

#### 14. feature-with-icons (Feature with Icon Lists)

Feature items with nested icon bullet points.

**XML:** `config/templates/includes/tailwind/blocks/feature-with-icons.xml`
**Twig:** `templates/includes/tailwind/blocks/feature-with-icons.html.twig`

| Property | Type | Description |
|----------|------|-------------|
| `headline` | text_line | Section headline |
| `description` | text_editor | Section description |
| `items[]` | nested block | Feature groups |

**Nested items → nested items:**
| Level | Property | Description |
|-------|----------|-------------|
| items | `headline` | Group headline |
| items.items | `text` | Bullet point text |

---

#### 15. formats (Format Cards with Icons)

Format cards with selectable icons.

**XML:** `config/templates/includes/tailwind/blocks/formats.xml`
**Twig:** `templates/includes/tailwind/blocks/formats.html.twig`

| Property | Type | Description |
|----------|------|-------------|
| `headline` | text_line | Section headline |
| `description` | text_editor | Section description |
| `items[]` | nested block | Format items |

**Nested items:**
| Property | Type | Description |
|----------|------|-------------|
| `icon` | single_select | Icon: user, newsletter, github |
| `headline` | text_line | Format title |
| `description` | text_editor | Format description |

---

### IMAGE & MEDIA BLOCKS

#### 16. image (Single Image)

Single image block.

**XML:** `config/templates/includes/tailwind/blocks/image.xml`
**Twig:** `templates/includes/tailwind/blocks/image.html.twig`

| Property | Type | Description |
|----------|------|-------------|
| `image` | media_selection | Image (max 1) |

---

#### 17. image-gallery (Image Gallery)

Gallery with headline, description, and multiple images.

**XML:** `config/templates/includes/tailwind/blocks/image-gallery.xml`
**Twig:** `templates/includes/tailwind/blocks/image-gallery.html.twig`

| Property | Type | Description |
|----------|------|-------------|
| `headline` | text_line | Gallery title |
| `description` | text_editor | Gallery description |
| `image` | media_selection | Multiple images |

---

#### 18. images-with-heading-and-description

Two images with headline and description.

**XML:** `config/templates/includes/tailwind/blocks/images-with-heading-and-description.xml`
**Twig:** `templates/includes/tailwind/blocks/images-with-heading-and-description.html.twig`

| Property | Type | Description |
|----------|------|-------------|
| `image` | media_selection | Images (max 2) |
| `headline` | text_line | Heading |
| `description` | text_editor | Description |

---

#### 19. image-with-flags (Image with Language Flags)

Image with country/language flag links.

**XML:** `config/templates/includes/tailwind/blocks/image-with-flags.xml`
**Twig:** `templates/includes/tailwind/blocks/image-with-flags.html.twig`

| Property | Type | Description |
|----------|------|-------------|
| `headline` | text_line | Heading |
| `image` | media_selection | Main image |
| `flags[]` | nested block | Flag links |

**Nested flags:**
| Property | Type | Description |
|----------|------|-------------|
| `language` | text_line | Country/language name |
| `url` | url | Link URL |

---

#### 20. logo-gallary (Logo Gallery)

Logo grid with links.

**XML:** `config/templates/includes/tailwind/blocks/logo-gallery.xml`
**Twig:** `templates/includes/tailwind/blocks/logo-gallary.html.twig`

| Property | Type | Description |
|----------|------|-------------|
| `headline` | text_line | Gallery title |
| `items[]` | nested block | Logo items |

**Nested items:**
| Property | Type | Description |
|----------|------|-------------|
| `headline` | text_line | Logo alt text |
| `url` | url | Logo link |
| `image` | media_selection | Logo image |

---

#### 21. excerpt-image (Excerpt Image)

Displays page excerpt image with headline.

**XML:** `config/templates/includes/tailwind/blocks/excerpt-image.xml`
**Twig:** `templates/includes/tailwind/blocks/excerpt-image.html.twig`

| Property | Type | Description |
|----------|------|-------------|
| `headline` | text_line | Optional override headline |

---

### CARD BLOCKS

#### 32. card-trio (1-3 Card Section)

Card section with 1-3 cards featuring icons, badges, tags, and internal page links. Uses nested `cards[]` array.

**XML:** `config/templates/includes/tailwind/blocks/card-trio.xml`
**Twig:** `templates/includes/tailwind/blocks/card-trio.html.twig`

**Top-Level Properties:**
| Property | Type | Description |
|----------|------|-------------|
| `subline` | text_line | Small text above headline (green) |
| `headline` | text_line | Main heading |
| `description` | text_editor | Section description |
| `footerText` | text_line | Footer text |
| `footerButtonText` | text_line | Footer button text |
| `footerButtonPage` | single_page_selection | Footer button page link (UUID) |

**Nested `cards[]` Properties (1-3 cards, type: "card"):**
| Property | Type | Description |
|----------|------|-------------|
| `type` | string | Must be "card" |
| `icon` | single_select | code, users, cog, bar-chart, lightbulb-o, rocket, shield, heart, star, check, universal-access, microchip |
| `title` | text_line | Card title |
| `description` | text_editor | Card description |
| `tags[]` | nested block | Tags (0-5 items with `type:"tag"` and `text`) |
| `linkText` | text_line | Link text (e.g., "Learn more") |
| `linkPage` | single_page_selection | Internal page link (UUID) |
| `badgeType` | single_select | none, urgent, warning, success, info |
| `badgeText` | text_line | Badge text (e.g., "New") |

**Badge Colors:**
- `urgent` - Red
- `warning` - Amber
- `success` - Green
- `info` - Blue

**MCP Example:**
```json
{
  "action": "add_block",
  "path": "/cmf/example/contents/my-page",
  "blockType": "card-trio",
  "headline": "What We Offer",
  "items": "[{\"type\":\"card\",\"icon\":\"code\",\"title\":\"Development\",\"description\":\"<p>Custom software.</p>\",\"tags\":[{\"type\":\"tag\",\"text\":\"PHP\"},{\"type\":\"tag\",\"text\":\"Symfony\"}],\"linkText\":\"Learn more\",\"linkPage\":\"page-uuid\",\"badgeType\":\"success\",\"badgeText\":\"Popular\"},{\"type\":\"card\",\"icon\":\"users\",\"title\":\"Consulting\",\"description\":\"<p>Expert advice.</p>\",\"tags\":[],\"linkText\":\"Get started\",\"linkPage\":\"page-uuid\",\"badgeType\":\"none\"}]",
  "locale": "de"
}
```

---

### CONTACT & TEAM BLOCKS

#### 33. team (Team Members)

Team member grid from contact accounts.

**XML:** `config/templates/includes/tailwind/blocks/team.xml`
**Twig:** `templates/includes/tailwind/blocks/team.html.twig`

| Property | Type | Description |
|----------|------|-------------|
| `headline` | text_line | Section headline |
| `description` | text_editor | Section description |
| `organisation` | contact_account_selection | Team members from Sulu contacts |

**Twig accesses from contact:**
- `item.avatar.thumbnails['team']`
- `item.fullName`
- `item.positionName`
- `item.contactDetails.socialMedia`
- `item.note`

---

#### 23. consultant (Single Consultant)

Single consultant/contact person display.

**XML:** `config/templates/includes/tailwind/blocks/consultant.xml`
**Twig:** `templates/includes/tailwind/blocks/consultant.html.twig`

| Property | Type | Description |
|----------|------|-------------|
| `organisation` | contact_account_selection | Consultant (max 1) |
| `description` | text_editor | Additional description |

---

#### 24. contact (Contact Box)

Contact section using snippets.

**XML:** `config/templates/includes/tailwind/blocks/contact.xml`
**Twig:** `templates/includes/tailwind/blocks/contact.html.twig`

| Property | Type | Description |
|----------|------|-------------|
| `snippets` | snippet_selection | Contact snippet (default: 'contact') |
| `description` | text_editor | Additional description |

---

#### 25. chat (Chat/Embed Block)

Chat or embed section.

**XML:** `config/templates/includes/tailwind/blocks/chat.xml`
**Twig:** `templates/includes/tailwind/blocks/chat.html.twig`

| Property | Type | Description |
|----------|------|-------------|
| `headline` | text_line | Section headline |
| `description` | text_editor | Description/embed code |

---

### NAVIGATION & DYNAMIC BLOCKS

#### 26. highlights (Snippet Highlights)

Display highlight snippets.

**XML:** `config/templates/includes/tailwind/blocks/highlights.xml`
**Twig:** `templates/includes/tailwind/blocks/highlights.html.twig`

| Property | Type | Description |
|----------|------|-------------|
| `snippets` | snippet_selection | Highlight snippets (default: 'highlights') |

---

#### 27. related-content-by-page-tag

Related content based on page tags.

**XML:** `config/templates/includes/tailwind/blocks/related-content-by-page-tag.xml`
**Twig:** `templates/includes/tailwind/blocks/related-content-by-page-tag.html.twig`

| Property | Type | Description |
|----------|------|-------------|
| `snippets` | snippet_selection | Uses excerpt tags for matching |

---

#### 28. subpages-overview (Child Pages)

Automatically lists child pages using smart_content.

**XML:** `config/templates/includes/tailwind/blocks/subpages-overview.xml`
**Twig:** `templates/includes/tailwind/blocks/subpages-overview.html.twig`

| Property | Type | Description |
|----------|------|-------------|
| `items` | smart_content | Auto-loads child pages with excerpts |

---

#### 29. table-of-contents (TOC)

Auto-generated table of contents.

**XML:** `config/templates/includes/tailwind/blocks/table-of-contents.xml`
**Twig:** `templates/includes/tailwind/blocks/table-of-contents.html.twig`

| Property | Type | Description |
|----------|------|-------------|
| `headline` | text_line | TOC title (e.g., "Contents") |

---

#### 30. html-raw (Raw HTML Embed)

Embed raw HTML content like YouTube iframes, custom embeds, or any HTML code.

**XML:** `config/templates/includes/tailwind/blocks/html-raw.xml`
**Twig:** `templates/includes/tailwind/blocks/html-raw.html.twig`

| Property | Type | Description |
|----------|------|-------------|
| `html` | text_editor | Raw HTML content (iframes, embeds, etc.) |

```json
{
  "blockType": "html-raw",
  "html": "<iframe src=\"https://www.youtube.com/embed/dQw4w9WgXcQ\" frameborder=\"0\" allowfullscreen></iframe>"
}
```

---

#### 31. youtube-from-channel (YouTube Playlist)

YouTube playlist embed.

**XML:** `config/templates/includes/tailwind/blocks/youTubeFromChannel.xml`
**Twig:** `templates/includes/tailwind/blocks/youtube-from-channel.html.twig`

| Property | Type | Description |
|----------|------|-------------|
| `headline` | text_line | Section headline |
| `subline` | text_line | Section subline |
| `playlistid` | text_line | YouTube playlist ID |

```json
{
  "blockType": "youtube-from-channel",
  "headline": "Our Videos",
  "subline": "Watch our latest tutorials",
  "playlistid": "PLxxxxxxxxxxxxxxxx"
}
```

---

#### 32. wordpressposts (WordPress Posts)

Fetches and displays WordPress posts.

**XML:** `config/templates/includes/tailwind/blocks/wordpressPosts.xml`
**Twig:** `templates/includes/tailwind/blocks/wordpressposts.html.twig`

| Property | Type | Description |
|----------|------|-------------|
| `headline` | text_line | Section headline |

---

## Block Categories Summary

| Category | Block Types |
|----------|-------------|
| **Content** | headline-paragraphs, faq, code, introduction, table |
| **Hero** | hero, hero-startpage, hero-image-right, heroslider |
| **CTA** | cta-button, button |
| **Feature** | feature, feature-default, feature-with-icons, formats |
| **Card** | card-trio |
| **Image** | image, image-gallery, images-with-heading-and-description, image-with-flags, logo-gallary, excerpt-image |
| **Contact** | team, consultant, contact, chat |
| **Navigation** | highlights, related-content-by-page-tag, subpages-overview, table-of-contents |
| **External** | html-raw, youtube-from-channel, wordpressposts |

---

## Workflow Examples

### Create Page with FAQ

```json
// 1. Create page
{"tool": "sulu-page-create", "parentPath": "/cmf/example/contents/support", "title": "Häufige Fragen", "resourceSegment": "/faq"}

// 2. Add FAQ block - NOTE: nestedType is "items" (NOT "faq")
{"tool": "sulu-block-add", "path": "/cmf/example/contents/support/faq", "blockType": "faq", "items": "[{\"type\":\"items\",\"headline\":\"Wie kann ich bestellen?\",\"subline\":\"Besuchen Sie unseren Shop und legen Sie Produkte in den Warenkorb.\"},{\"type\":\"items\",\"headline\":\"Wie lange dauert die Lieferung?\",\"subline\":\"Standard-Lieferung dauert 3-5 Werktage.\"}]"}

// 3. Publish
{"tool": "sulu-page-publish", "path": "/cmf/example/contents/support/faq"}
```

### Create Page with Table

```json
// 1. Create page
{"tool": "sulu-page-create", "parentPath": "/cmf/example/contents/preise", "title": "Preisliste", "resourceSegment": "/preisliste"}

// 2. Add table block - NOTE: nestedType is "row"
{"tool": "sulu-block-add", "path": "/cmf/example/contents/preise/preisliste", "blockType": "table", "headline": "Unsere Tarife", "description": "<p>Wählen Sie den passenden Tarif.</p>", "columnheader1": "Tarif", "columnheader2": "Preis", "columnheader3": "Funktionen", "items": "[{\"type\":\"row\",\"cell1\":\"Starter\",\"cell2\":\"9,99 €\",\"cell3\":\"5 Projekte\"},{\"type\":\"row\",\"cell1\":\"Professional\",\"cell2\":\"29,99 €\",\"cell3\":\"Unbegrenzt\"}]"}

// 3. Publish
{"tool": "sulu-page-publish", "path": "/cmf/example/contents/preise/preisliste"}
```

---

## Media & Snippet Actions

### list_media Action

Search and list media files from Sulu's media library.

```json
{
  "action": "list_media",
  "search": "logo",
  "collectionId": 1,
  "locale": "de",
  "limit": 50,
  "offset": 0
}
```

Response:
```json
{
  "media": [
    {
      "id": 42,
      "title": "Company Logo",
      "filename": "logo.png",
      "mimeType": "image/png",
      "size": 12345,
      "collectionId": 1
    }
  ],
  "total": 1,
  "limit": 50,
  "offset": 0
}
```

Use media IDs in blocks:
```json
{
  "blockType": "image",
  "image": {"id": 42}
}
```

### list_snippets Action

List snippets with diagnostic information when empty.

```json
{
  "action": "list_snippets",
  "snippetType": "contact",
  "locale": "de"
}
```

Response (with snippets):
```json
{
  "snippets": [
    {
      "uuid": "abc-123-def",
      "title": "Main Contact",
      "type": "contact",
      "template": "contact",
      "path": "/cmf/example/snippets/contact/main"
    }
  ]
}
```

Response (no snippets - with diagnostic):
```json
{
  "snippets": [],
  "diagnostic": {
    "searched_path": "/cmf/example/snippets/contact",
    "workspaces_checked": ["default", "default_live"],
    "hint": "No snippets found at this path. Create snippets in Sulu admin under 'Snippets' section."
  }
}
```

### get_block_schema Action

Get detailed schema for a specific block type including description and example.

```json
{
  "action": "get_block_schema",
  "blockTypeName": "faq"
}
```

Response:
```json
{
  "name": "faq",
  "properties": [],
  "nested": "faqs",
  "nestedType": "items",
  "nestedProperties": ["headline", "subline"],
  "description": "FAQ section with expandable questions/answers. Uses faqs[] array (NOT items).",
  "example": {
    "type": "faq",
    "faqs": [
      {"type": "items", "headline": "What is PHP?", "subline": "PHP is a server-side scripting language."}
    ]
  }
}
```

**IMPORTANT:** The `nestedType` field tells you what `type` value to use for each nested item. For FAQ, use `"type":"items"` (NOT `"type":"faq"`).

### list_block_types Action

List all 34 block types with full documentation.

```json
{
  "action": "list_block_types"
}
```

Response includes for each type:
- `name` - Block type identifier
- `properties` - Top-level properties
- `nested` - Name of nested array (e.g., 'items', 'faqs', 'rows')
- `nestedType` - **CRITICAL:** The `type` value required for each nested item (e.g., 'items', 'card', 'row')
- `nestedProperties` - Properties within nested items
- `description` - Human-readable description
- `example` - Complete example data structure

**IMPORTANT:** Always check `nestedType` before creating nested items. Using the wrong type causes items to not render in the frontend.

---

## Known Snippet UUIDs (Contact Snippets)

These contact snippets are available for use in `contact` blocks via the `snippets` parameter:

| Themenbereich | Snippet UUID | Titel |
|---------------|-------------|-------|
| KI Content Marketing | `cdba3044-9725-41c0-8056-0437dfae2841` | Ihr Ansprechpartner für KI Content Marketing |
| PHP Consulting | `4499c20b-6de3-4999-9c85-cab9deeb789b` | PHP Consultant Spezialisten |
| Barrierefreiheit | `e3175c1c-0530-43fd-9e18-b5e83794b1f1` | Spezialisten zu barrierefreiem Webdesign |
| Frontend/Astro | `c410e179-203d-4573-a4fe-b20525797463` | Frontend 2025 mit Astro JS |
| Accessibility Dev | `70ed51ae-641e-4908-9c82-fc893ff0fe2c` | Frontend-Entwicklung mit Accessibility |

**Usage in contact block:**
```json
{
  "action": "add_block",
  "path": "/cmf/example/contents/my-page",
  "blockType": "contact",
  "snippets": "[\"cdba3044-9725-41c0-8056-0437dfae2841\"]",
  "description": "<p>Kontaktieren Sie uns für KI Content Marketing.</p>"
}
```

## Known Media IDs

| Thema | Media ID | Dateiname |
|-------|----------|-----------|
| MCP Server | 993 | nca-mcp-php-server.jpg |

**Usage in excerpt image:**
```json
{
  "action": "create_page",
  "parentPath": "/cmf/example/contents",
  "title": "MCP Server",
  "resourceSegment": "/mcp-server",
  "excerptImage": 993
}
```

---

## Template Pages & Content Workflows

### Template Pages by Content Area

Use these pages as templates with `copy_page` to quickly create new content:

| Content Area | Template Page Path | Description |
|--------------|-------------------|-------------|
| PHP Glossar | `/cmf/example/contents/glossare/nca-php-glossar/phpunit` | PHP glossary entry with standard structure |
| KI Tools | `/cmf/example/contents/ki-tools` | KI/AI tool pages |
| Accessibility | `/cmf/example/contents/barrierefreiheit` | Accessibility content pages |
| Training | `/cmf/example/contents/training` | Training course pages (uses `hl-des` blocks) |

### Standard Content Workflow

1. **Find template**: `get` a template page to understand its block structure
2. **Copy**: `copy_page` to create new page with same structure
3. **Customize**: `update_block` to change content in individual blocks
4. **Add content**: `add_block` / `append_to_block` for additional content
5. **Publish**: `publish` to make page live

### Copy Workflow Example

```json
// Step 1: Copy an existing glossary entry as template
{"action": "copy_page", "sourcePath": "/cmf/example/contents/glossare/nca-php-glossar/phpunit", "parentPath": "/cmf/example/contents/glossare/nca-php-glossar", "title": "PHPStan", "resourceSegment": "/phpstan"}

// Step 2: Update the first block with new content
{"action": "update_block", "path": "/cmf/example/contents/glossare/nca-php-glossar/phpstan", "position": 0, "headline": "Was ist PHPStan?", "items": "[{\"type\":\"description\",\"description\":\"<p>PHPStan ist ein statisches Analyse-Tool für PHP.</p>\"}]"}

// Step 3: Publish when ready
{"action": "publish", "path": "/cmf/example/contents/glossare/nca-php-glossar/phpstan"}
```

---

## Common Mistakes to Avoid

### Mistake 0: Using hl-des on non-training pages
```json
{"blockType": "hl-des", "path": "/cmf/example/contents/glossare/php"}
```
**Error:** `Block type 'hl-des' is only allowed on /training/* pages. Use 'headline-description' or 'headline-paragraphs' instead.`

**Fix:** Use `headline-paragraphs` for glossar, blog, and other content pages. `hl-des` is restricted to `/training/*` pages only.

### Mistake 1: Using wrong nested block name for FAQ
```json
{"blockType": "faq", "items": "[...]"}
```
**Fix:** FAQ uses `faqs`, not `items`:
```json
{"blockType": "faq", "faqs": "[...]"}
```

### Mistake 2: Using `description` for FAQ answers
```json
{"faqs": "[{\"headline\":\"Question\",\"description\":\"Answer\"}]"}
```
**Fix:** FAQ uses `subline` for answers:
```json
{"faqs": "[{\"headline\":\"Question\",\"subline\":\"Answer\"}]"}
```

### Mistake 3: Using wrong nested block name for table
```json
{"blockType": "table", "items": "[...]"}
```
**Fix:** Table uses `rows`:
```json
{"blockType": "table", "rows": "[...]"}
```

### Mistake 4: items as object instead of JSON string
```json
{"items": [{"type":"description"...}]}
```
**Fix:** Nested blocks must be JSON strings:
```json
{"items": "[{\"type\":\"description\"...}]"}
```

### Mistake 5: Forgetting to publish
Changes are only visible in draft until `publish` is called.

---

## Path Format

Sulu uses PHPCR paths:
```
/cmf/example/contents/[section]/[page-slug]
```

## Locale

- `de` - German (default)
- `en` - English

---

## Contact

Questions about the MCP Server: https://nevercodealone.de
