# Sulu CMS MCP Server - LLM Documentation

> This file helps LLMs correctly use the Sulu CMS API.

## Overview

The Sulu MCP Server enables managing CMS pages via these actions:

### Page Discovery
- `sulu-page-search` - Search pages by title (case-insensitive)
- `sulu-page-tree` - Get hierarchical page tree structure
- `sulu-page-find-by-url` - Find page by frontend URL
- `sulu-page-list` - List all pages under a path

### Page Management
- `sulu-page-get` - Get page with all blocks
- `sulu-page-create` - Create a new page
- `sulu-page-publish` - Publish page
- `sulu-page-unpublish` - Unpublish page

### Block Management
- `sulu-block-add` - Add a block
- `sulu-block-update` - Update a block
- `sulu-block-move` - Move a block
- `sulu-block-remove` - Remove a block
- `sulu-block-types` - List available block types

## Page Discovery

Use these tools to find pages before creating or modifying content.

### search Action

Search pages by title (case-insensitive).

```json
{
  "action": "search",
  "query": "PHP",
  "locale": "de"
}
```

Response:
```json
[
  {"path": "/cmf/example/contents/php-glossar", "title": "PHP Glossar", "url": "/php-glossar"},
  {"path": "/cmf/example/contents/php-training", "title": "PHP Training", "url": "/php-training"}
]
```

### tree Action

Get hierarchical page structure. Use to find parent paths for new pages.

```json
{
  "action": "tree",
  "rootPath": "/cmf/example/contents/glossare",
  "locale": "de",
  "depth": 2
}
```

Response:
```json
{
  "path": "/cmf/example/contents/glossare",
  "title": "Glossare",
  "children": [
    {
      "path": "/cmf/example/contents/glossare/php-glossar",
      "title": "PHP Glossar",
      "children": [...]
    }
  ]
}
```

### find_by_url Action

Convert frontend URL to PHPCR path.

```json
{
  "action": "find_by_url",
  "url": "/de/php-glossar",
  "locale": "de"
}
```

or without locale prefix:
```json
{
  "action": "find_by_url",
  "url": "/php-glossar",
  "locale": "de"
}
```

Response:
```json
{
  "path": "/cmf/example/contents/php-glossar",
  "title": "PHP Glossar",
  "url": "/php-glossar"
}
```

## Creating Pages

### sulu-page-create

Create new pages under an existing parent path.

**IMPORTANT:** Always use `sulu-page-tree` first to find valid parent paths!

#### Parameters:

| Parameter | Required | Description |
|-----------|----------|-------------|
| `parentPath` | Yes | PHPCR path of parent page (use `sulu-page-tree` to find valid paths) |
| `title` | Yes | Page title |
| `resourceSegment` | Yes | URL slug starting with `/`, e.g. `/my-page` (lowercase, numbers, hyphens only) |
| `locale` | No | Language code: `de` or `en` (default: `de`) |
| `seoTitle` | No | SEO meta title (defaults to page title) |
| `seoDescription` | No | SEO meta description |
| `publish` | No | Publish immediately: `true` or `false` (default: `false`) |

#### Example: Create a New Page

```json
// Step 1: Find valid parent path
{"tool": "sulu-page-tree", "rootPath": "/cmf/example/contents", "depth": 1}

// Step 2: Create the page
{
  "tool": "sulu-page-create",
  "parentPath": "/cmf/example/contents/nca-php-glossar",
  "title": "Docker Grundlagen",
  "resourceSegment": "/docker-grundlagen",
  "seoTitle": "Docker Grundlagen - Container Tutorial",
  "seoDescription": "Lerne die Grundlagen von Docker und Container-Technologie.",
  "locale": "de",
  "publish": false
}
```

#### Response:

```json
{
  "success": true,
  "message": "Page created successfully",
  "path": "/cmf/example/contents/nca-php-glossar/docker-grundlagen",
  "uuid": "abc123-def456-...",
  "url": "/de/docker-grundlagen"
}
```

#### Error Response (Invalid Parent):

```json
{
  "success": false,
  "message": "Parent path does not exist: /cmf/example/contents/nonexistent"
}
```

#### Important Notes:

1. **Use sulu-page-tree first**: Always verify the parent path exists before creating
2. **Template**: All pages use the `tailwind` template (hardcoded)
3. **resourceSegment format**: Must start with `/` and contain only `[a-z0-9-]`
4. **Parent must exist**: The parentPath must point to an existing page
5. **Empty page**: Created pages have no blocks - use `sulu-block-add` after creation
6. **Publish behavior**: If `publish: true`, page is immediately live and cache is invalidated

## Block Types and Their Structures

### 1. headline-paragraphs (Most Important Block Type!)

For tutorials, guides, documentation with **alternating text and code**.

#### CORRECT Structure:

```json
{
  "action": "add_block",
  "blockType": "headline-paragraphs",
  "headline": "Installation Guide",
  "items": "[{\"type\":\"description\",\"content\":\"<p>First, install the dependencies:</p>\"},{\"type\":\"code\",\"code\":\"composer require vendor/package\",\"language\":\"bash\"},{\"type\":\"description\",\"content\":\"<p>Then configure the class:</p>\"},{\"type\":\"code\",\"code\":\"$config = new Config();\\n$config->set('key', 'value');\",\"language\":\"php\"},{\"type\":\"description\",\"content\":\"<p>Done! Installation is complete.</p>\"}]",
  "path": "/cmf/example/contents/page",
  "locale": "de"
}
```

#### WRONG Structure (Code inline in HTML):

```json
{
  "items": "[{\"type\":\"description\",\"content\":\"<p>Text<pre><code>composer require x</code></pre>more text</p>\"}]"
}
```

**Why wrong?** Code won't render as a code block, no syntax highlighting, poor readability.

#### Item Types for headline-paragraphs:

| type | fields | description |
|------|--------|-------------|
| `description` | `content` (HTML) | Prose text, can contain `<p>`, `<ul>`, `<h3>`, `<strong>` etc. |
| `code` | `code`, `language` | Code block with syntax highlighting |

#### Available Languages for Code Blocks:

- `php` - PHP Code
- `bash` - Shell/Terminal Commands
- `javascript` - JavaScript/Node.js
- `html` - HTML Markup
- `css` - CSS Styles
- `xml` - XML/SVG
- `yaml` - YAML Config
- `json` - JSON Data

### 2. hl-des (Headline + Description)

Simple block for headline with description.

```json
{
  "action": "add_block",
  "blockType": "hl-des",
  "headline": "About Us",
  "content": "<p>We are a team of developers...</p>",
  "path": "/cmf/example/contents/page",
  "locale": "de"
}
```

### 3. text

Pure text block without headline.

```json
{
  "action": "add_block",
  "blockType": "text",
  "content": "<p>Lorem ipsum dolor sit amet...</p>",
  "path": "/cmf/example/contents/page",
  "locale": "de"
}
```

### 4. code

Standalone code block (without surrounding text).

```json
{
  "action": "add_block",
  "blockType": "code",
  "content": "echo 'Hello World';",
  "path": "/cmf/example/contents/page",
  "locale": "de"
}
```

### 5. image

Image block with optional caption.

```json
{
  "action": "add_block",
  "blockType": "image",
  "headline": "Screenshot",
  "content": "<p>Image description</p>",
  "path": "/cmf/example/contents/page",
  "locale": "de"
}
```

**Note:** Images must be uploaded via Sulu Media Library. The image.ids are set separately.

### 6. quote

Quote block.

```json
{
  "action": "add_block",
  "blockType": "quote",
  "content": "The best code is the code you don't have to write.",
  "path": "/cmf/example/contents/page",
  "locale": "de"
}
```

### 7. video

Video embed block.

```json
{
  "action": "add_block",
  "blockType": "video",
  "headline": "Tutorial Video",
  "content": "https://youtube.com/watch?v=xxx",
  "path": "/cmf/example/contents/page",
  "locale": "de"
}
```

## Important Parameters

### Path Format

Sulu uses PHPCR paths:
```
/cmf/example/contents/[section]/[subsection]/[page-slug]
```

Examples:
- `/cmf/example/contents/glossare/nca-php-glossar/phpunit`
- `/cmf/example/contents/blog/2025/my-article`

### Locale

- `de` - German
- `en` - English

### Position (0-based)

- `position: 0` = First block
- `position: 5` = Sixth block
- For `add_block`: Position where to insert
- For `update_block`/`remove_block`: Which block is affected

## Workflow Examples

### Create New Page with Content

```
1. search -> Find existing similar pages by title
2. tree -> Understand page hierarchy, find parent path
3. create_page -> Create page under parent
4. add_block (headline-paragraphs) -> Add content blocks
5. add_block -> Add more blocks as needed
6. publish -> Make live
```

Example workflow:
```json
// Step 1: Search for existing Docker pages
{"action": "search", "query": "Docker", "locale": "de"}

// Step 2: Get tree to find parent path
{"action": "tree", "rootPath": "/cmf/example/contents/glossare", "depth": 1}

// Step 3: Create the page
{"action": "create_page", "parentPath": "/cmf/example/contents/glossare", "title": "Docker Tutorial", "resourceSegment": "/docker-tutorial", "seoTitle": "Docker Tutorial", "seoDescription": "Learn Docker basics"}

// Step 4: Add content block
{"action": "add_block", "path": "/cmf/example/contents/glossare/docker-tutorial", "blockType": "headline-paragraphs", "headline": "Getting Started", "items": "[{\"type\":\"description\",\"content\":\"<p>Docker is a containerization platform.</p>\"}]"}

// Step 5: Publish
{"action": "publish", "path": "/cmf/example/contents/glossare/docker-tutorial"}
```

### Add Content to Existing Page

```
1. get -> Check current blocks
2. add_block (headline-paragraphs) with items array
3. publish -> Make live
```

### Update Block

```
1. get -> Find position and current content
2. update_block with new items
3. publish
```

### Delete Block

```
1. get -> Identify position
2. remove_block with position
3. publish
```

## Common Mistakes to Avoid

### Mistake 1: Embedding code in HTML
```json
{"content": "<p>Install:<pre><code>npm install</code></pre></p>"}
```
**Fix:** Use a separate code item.

### Mistake 2: items as object instead of JSON string
```json
{"items": [{"type":"description"...}]}
```
**Fix:** items must be a JSON string, not an array object:
```json
{"items": "[{\"type\":\"description\"...}]"}
```

### Mistake 3: Forgetting language for code items
```json
{"type": "code", "code": "echo 1;"}
```
**Fix:** Always specify `"language": "php"` (or other).

### Mistake 4: Forgetting to publish
Changes are only visible in draft until `publish` is called.

### Mistake 5: <?php in code blocks
```json
{"type": "code", "code": "<?php\necho 'test';", "language": "php"}
```
**Fix:** No `<?php` tag! The block is already marked as PHP:
```json
{"type": "code", "code": "echo 'test';", "language": "php"}
```

### Mistake 6: Invalid resourceSegment for create_page
```json
{"resourceSegment": "my-page"}
{"resourceSegment": "/My-Page"}
{"resourceSegment": "/my_page"}
```
**Fix:** Must start with `/` and contain only lowercase letters, numbers, hyphens:
```json
{"resourceSegment": "/my-page"}
```

### Mistake 7: Creating page under non-existent parent
```json
{"action": "create_page", "parentPath": "/cmf/example/contents/nonexistent/path", ...}
```
**Fix:** Use `search` or `tree` first to find valid parent paths.

## Response Interpretation

### Successful Response
```json
{
  "success": true,
  "message": "Block added successfully",
  "blocks": [...]
}
```

### Error
```json
{
  "success": false,
  "error": "Block not found at position 99"
}
```

## Contact

Questions about the MCP Server: https://nevercodealone.de
