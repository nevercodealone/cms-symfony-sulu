# config/packages/ai.yaml
services:
    _defaults:
        autowire: true
        autoconfigure: true

    Codewithkyrian\ChromaDB\Client:
        factory: ['@chroma.factory', 'connect']

    chroma.factory:
        class: Codewithkyrian\ChromaDB\Factory
        calls:
            - method: withHost
              arguments:
                - 'http://%env(CHROMADB_HOST)%'
            - method: withPort
              arguments:
                - '%env(int:CHROMADB_PORT)%'
            - method: withDatabase
              arguments:
                - '%env(CHROMADB_DATABASE)%'
            - method: withTenant
              arguments:
                - 'default_tenant'

    Symfony\AI\Agent\Toolbox\Tool\SimilaritySearch:
        $store: '@ai.store.chroma_db.video'
        $vectorizer: '@ai.vectorizer.openai_embeddings'
    Symfony\AI\Store\Document\Transformer\TextSplitTransformer: ~

ai:
    platform:
        openai:
            api_key: '%env(OPENAI_API_KEY)%'

    vectorizer:
        openai_embeddings:
            platform: 'ai.platform.openai'
            model:
                class: 'Symfony\AI\Platform\Bridge\OpenAi\Embeddings'
                name: 'text-embedding-3-small'

    agent:
        youtube_bot:
            model:
                class: 'Symfony\AI\Platform\Bridge\OpenAi\Gpt'
                name: 'gpt-4o-mini'
                options:
                    temperature: 0.3
                    max_tokens: 1000
            system_prompt: |
                Du bist Robot Golla, ein Chatbot für "Never Code Alone".
                Du hast Zugriff auf zwei Wissensquellen:
                1. video_search - YouTube Videos von Never Code Alone
                2. content_search - Webseiten-Inhalte von nevercodealone.de

                WICHTIG: Verwende BEIDE Tools um die beste Antwort zu finden!
                - Bei Fragen zu Tutorials/Coding → video_search
                - Bei Fragen zur Website/Services/Angeboten → content_search
                - Bei allgemeinen Fragen → beide Tools nutzen

                Regeln:
                1. Basiere deine Antwort NUR auf den gefundenen Inhalten
                2. Wenn keine passenden Inhalte gefunden werden, sage "Dazu habe ich leider keine Informationen gefunden"
                3. Verwende IMMER "du"-Ansprache
                4. Bei gefundenen Videos: Liste relevante Videos als nummerierte Liste mit Titel und Link auf
                5. Bei Webseiten-Inhalten: Verweise auf die entsprechende Seite mit URL
            include_tools: true
            tools:
                - service: 'Symfony\AI\Agent\Toolbox\Tool\SimilaritySearch'
                  name: 'video_search'
                  description: 'Sucht YouTube Videos von Never Code Alone zu einem Thema.'
                  method: '__invoke'
                - service: 'App\Store\SuluContentSearch'
                  name: 'content_search'
                  description: 'Sucht Webseiten-Inhalte von nevercodealone.de (Services, Angebote, Blog-Artikel).'
                  method: '__invoke'

    store:
        chroma_db:
            video:
                collection: 'youtube_videos'
            sulu_content:
                collection: 'sulu_content'

    indexer:
        default:
            store: 'ai.store.chroma_db.video'
            vectorizer: 'ai.vectorizer.openai_embeddings'
        sulu:
            store: 'ai.store.chroma_db.sulu_content'
            vectorizer: 'ai.vectorizer.openai_embeddings'
