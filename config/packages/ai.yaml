# config/packages/ai.yaml
services:
    _defaults:
        autowire: true
        autoconfigure: true

    Codewithkyrian\ChromaDB\Client:
        factory: ['@chroma.factory', 'connect']

    chroma.factory:
        class: Codewithkyrian\ChromaDB\Factory
        calls:
            - method: withHost
              arguments:
                - 'http://%env(CHROMADB_HOST)%'
            - method: withPort
              arguments:
                - '%env(int:CHROMADB_PORT)%'
            - method: withDatabase
              arguments:
                - '%env(CHROMADB_DATABASE)%'
            - method: withTenant
              arguments:
                - 'default_tenant'

    Symfony\AI\Agent\Toolbox\Tool\SimilaritySearch:
        $store: '@ai.store.chroma_db.video'
        $vectorizer: '@ai.vectorizer.openai_embeddings'
    Symfony\AI\Store\Document\Transformer\TextSplitTransformer: ~

ai:
    platform:
        openai:
            api_key: '%env(OPENAI_API_KEY)%'

    vectorizer:
        openai_embeddings:
            platform: 'ai.platform.openai'
            model:
                class: 'Symfony\AI\Platform\Bridge\OpenAi\Embeddings'
                name: 'text-embedding-ada-002'

    agent:
        youtube_bot:
            model:
                class: 'Symfony\AI\Platform\Bridge\OpenAi\Gpt'
                name: 'gpt-4o'
            system_prompt: |
                Du bist Robot Golla, ein freundlicher Chatbot aus dem Bereich des Software-Entertainments. Du hilfst den
                Nutzern und Fans von "Never Code Alone" informationen aus YouTube-Videos zu finden. 
                
                WICHTIG: Verwende IMMER die informelle "du"-Ansprache! Niemals "Sie", "Ihnen", "Ihre" verwenden.
                Sprich die Nutzer mit "du", "dir", "dein/deine" an - wir sind alle Freunde hier!
                
                Du sollst dabei Tools verwenden, um relevante Videos zu suchen und deren Inhalte zu analysieren. 
                Deine Antworten sollten immer freundlich, hilfsbereit und informativ sein. 
                
                Wenn du ein Video gefunden hast, das relevant ist, gib bitte den Titel, die Beschreibung und den 
                Link zum Video an. Wenn du keine relevanten Videos oder Inhalte findest, informiere den Nutzer 
                darüber und biete an, eine andere Suche durchzuführen.
                
                Versuche auch generelle Fragen zu Software-Entwicklung anhand von Video-Inhalten, die du mit dem Tool
                "video_search" gesucht hast, zu beantworten und dabei dann die Video mit Titel zu verlinken.
            include_tools: true
            tools:
                - service: 'Symfony\AI\Agent\Toolbox\Tool\SimilaritySearch'
                  name: 'video_search'
                  description: 'Searches for relevant YouTube videos based on a search query.'
                  method: '__invoke'

    store:
        chroma_db:
            video:
                collection: 'youtube_videos'

    indexer:
        default:
            store: 'ai.store.chroma_db.video'
            vectorizer: 'ai.vectorizer.openai_embeddings'
